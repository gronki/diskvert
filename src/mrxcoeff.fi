!------------------------------------------------------------------------------!
! thermal diffusion
! alpha prescription
! no thermal conduction
pure subroutine mrx_coeff1_ad (z,Y,D,F,A,MY,MD)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
! first column: values, second column: 1ord derivatives
real(dp), dimension(:), intent(in) :: Y,D
! each row is one Function: its value and derivatives to rho and T
real(dp), dimension(:,:), intent(in) :: F
! right-hand-side of the equation
real(dp), dimension(:), intent(out) :: A
! jacobians with respect to Y and dY/dz
real(dp), dimension(:,:), intent(out) :: MY, MD
A(1) = -cgs_k_over_mh*D(1)*Y(2)/miu - cgs_k_over_mh*D(2)*Y(1)/miu - &
      omega**2*z*Y(1) + F(1,1)*Y(1)*Y(3)/cgs_c
A(2) = -16*cgs_stef*D(2)*Y(2)**3 - 3*F(1,1)*Y(1)*Y(3)
A(3) = alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)* &
      cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha)) - D(3)
MY(1,1) = cgs_k_over_mh*D(2)/miu + omega**2*z - F(1,1)*Y(3)/cgs_c - F(2, &
      1)*Y(1)*Y(3)/cgs_c
MY(2,1) = 3*F(1,1)*Y(3) + 3*F(2,1)*Y(1)*Y(3)
MY(3,1) = -alpha*cgs_k_over_mh*omega*Y(2)/miu
MY(1,2) = cgs_k_over_mh*D(1)/miu - F(3,1)*Y(1)*Y(3)/cgs_c
MY(2,2) = 48*cgs_stef*D(2)*Y(2)**2 + 3*F(3,1)*Y(1)*Y(3)
MY(3,2) = -alpha*omega*(cgs_k_over_mh*Y(1)/miu + merge((16.0d0/3.0d0)* &
      cgs_stef*Y(2)**3/cgs_c, 0.0d0, use_prad_in_alpha))
MY(1,3) = -F(1,1)*Y(1)/cgs_c
MY(2,3) = 3*F(1,1)*Y(1)
MY(3,3) = 0
MD(1,1) = cgs_k_over_mh*Y(2)/miu
MD(2,1) = 0
MD(3,1) = 0
MD(1,2) = cgs_k_over_mh*Y(1)/miu
MD(2,2) = 16*cgs_stef*Y(2)**3
MD(3,2) = 0
MD(1,3) = 0
MD(2,3) = 0
MD(3,3) = 1
end subroutine

pure subroutine mrx_coeffbl_ad (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -Y(3)
MB(1,1) = 0
MB(1,2) = 0
MB(1,3) = 1
end subroutine

pure subroutine mrx_coeffbr_ad (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = facc - Y(3)
B(2) = 2*cgs_stef*Y(2)**4 - Y(3)
MB(1,1) = 0
MB(2,1) = 0
MB(1,2) = 0
MB(2,2) = -8*cgs_stef*Y(2)**3
MB(1,3) = 1
MB(2,3) = 1
end subroutine

pure subroutine mrx_output_ad (z,Y,YY)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:), intent(out) :: YY
YY(1) = Y(1)
YY(2) = Y(2)
YY(3) = Y(2)
YY(4) = cgs_k_over_mh*Y(1)*Y(2)/miu
YY(5) = (4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c
YY(6) = 0
YY(7) = Y(3)
YY(8) = 0
YY(9) = 0
YY(10) = cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(2) &
      **4/cgs_c, 0.0d0, use_prad_in_alpha)
YY(11) = alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)* &
      cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha))
YY(12) = 0
YY(13) = 0
YY(14) = 0
YY(15) = 0
end subroutine

!------------------------------------------------------------------------------!
! thermal diffusion
! magnetic heating
! no thermal conduction
pure subroutine mrx_coeff1_md (z,Y,D,F,A,MY,MD)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
! first column: values, second column: 1ord derivatives
real(dp), dimension(:), intent(in) :: Y,D
! each row is one Function: its value and derivatives to rho and T
real(dp), dimension(:,:), intent(in) :: F
! right-hand-side of the equation
real(dp), dimension(:), intent(out) :: A
! jacobians with respect to Y and dY/dz
real(dp), dimension(:,:), intent(out) :: MY, MD
A(1) = -cgs_k_over_mh*D(1)*Y(2)/miu - cgs_k_over_mh*D(2)*Y(1)/miu - &
      omega**2*z*Y(1) - D(4) + F(1,1)*Y(1)*Y(3)/cgs_c
A(2) = -16*cgs_stef*D(2)*Y(2)**3 - 3*F(1,1)*Y(1)*Y(3)
A(3) = alpha*nu*omega*Y(4) - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(4))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + omega*(alpha*nu + 2*eta)*Y(4) - D(3)
A(4) = alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef &
      *Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(4))*merge(qmri_kill &
      *(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt &
      (Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - eta*z*D(4) - (alpha*nu + 2*eta)*Y &
      (4)
MY(1,1) = cgs_k_over_mh*D(2)/miu + omega**2*z - F(1,1)*Y(3)/cgs_c - F(2, &
      1)*Y(1)*Y(3)/cgs_c
MY(2,1) = 3*F(1,1)*Y(3) + 3*F(2,1)*Y(1)*Y(3)
MY(3,1) = alpha*cgs_k_over_mh*omega*merge(qmri_kill*(0.646142399166004d0 &
      *sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge(( &
      4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + &
      Y(4))*merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(4)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(4)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(4,1) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(4)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(4))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(4)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(4)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(1,2) = cgs_k_over_mh*D(1)/miu - F(3,1)*Y(1)*Y(3)/cgs_c
MY(2,2) = 48*cgs_stef*D(2)*Y(2)**2 + 3*F(3,1)*Y(1)*Y(3)
MY(3,2) = alpha*omega*(cgs_k_over_mh*Y(1)/miu + merge((16.0d0/3.0d0)* &
      cgs_stef*Y(2)**3/cgs_c, 0.0d0, use_prad_in_alpha))*merge( &
      qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + alpha*omega*(cgs_k_over_mh*Y(1)*Y &
      (2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(4))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)*( &
      -0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt( &
      Y(1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(4)) - 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2)**2 + qmri_kill*(0.323071199583002d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (2)*Y(4)) + 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2), 0.0d0, &
      use_quench_mri)
MY(4,2) = -alpha*(cgs_k_over_mh*Y(1)/miu + merge((16.0d0/3.0d0)*cgs_stef &
      *Y(2)**3/cgs_c, 0.0d0, use_prad_in_alpha))*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - alpha*(cgs_k_over_mh*Y(1)*Y(2)/ &
      miu + merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(4))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)*( &
      -0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt( &
      Y(1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(4)) - 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2)**2 + qmri_kill*(0.323071199583002d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (2)*Y(4)) + 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2), 0.0d0, &
      use_quench_mri)
MY(1,3) = -F(1,1)*Y(1)/cgs_c
MY(2,3) = 3*F(1,1)*Y(1)
MY(3,3) = 0
MY(4,3) = 0
MY(1,4) = 0
MY(2,4) = 0
MY(3,4) = -alpha*nu*omega + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(4))*merge(qmri_kill*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)**2) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow/Y(4))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)**2) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow/Y(4))*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2)**2, 0.0d0, &
      use_quench_mri) + alpha*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - omega*(alpha*nu + 2*eta)
MY(4,4) = alpha*nu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(4))* &
      merge(qmri_kill*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)**2) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow/Y(4))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2) + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)**2) + 1.0d0*threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh &
      )*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))** &
      threshpow/Y(4))*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)/(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) &
      **2, 0.0d0, use_quench_mri) - alpha*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + 2*eta
MD(1,1) = cgs_k_over_mh*Y(2)/miu
MD(2,1) = 0
MD(3,1) = 0
MD(4,1) = 0
MD(1,2) = cgs_k_over_mh*Y(1)/miu
MD(2,2) = 16*cgs_stef*Y(2)**3
MD(3,2) = 0
MD(4,2) = 0
MD(1,3) = 0
MD(2,3) = 0
MD(3,3) = 1
MD(4,3) = 0
MD(1,4) = 1
MD(2,4) = 0
MD(3,4) = 0
MD(4,4) = eta*z
end subroutine

pure subroutine mrx_coeffbl_md (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -Y(3)
B(2) = alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef &
      *Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(4))*merge(qmri_kill &
      *(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt &
      (Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - (alpha*nu + 2*eta)*Y(4)
MB(1,1) = 0
MB(2,1) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(4)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(4))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(4)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(4)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2), 0.0d0, use_quench_mri)
MB(1,2) = 0
MB(2,2) = -alpha*(cgs_k_over_mh*Y(1)/miu + merge((16.0d0/3.0d0)*cgs_stef &
      *Y(2)**3/cgs_c, 0.0d0, use_prad_in_alpha))*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - alpha*(cgs_k_over_mh*Y(1)*Y(2)/ &
      miu + merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(4))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)*( &
      -0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt( &
      Y(1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(4)) - 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2)**2 + qmri_kill*(0.323071199583002d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (2)*Y(4)) + 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2), 0.0d0, &
      use_quench_mri)
MB(1,3) = 1
MB(2,3) = 0
MB(1,4) = 0
MB(2,4) = alpha*nu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(4))* &
      merge(qmri_kill*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)**2) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow/Y(4))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2) + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)**2) + 1.0d0*threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh &
      )*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))** &
      threshpow/Y(4))*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)/(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) &
      **2, 0.0d0, use_quench_mri) - alpha*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + 2*eta
end subroutine

pure subroutine mrx_coeffbr_md (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -2*eta*omega*z*Y(4) + facc - merge(alpha*omega*z*Y(4)/(alpha*nu/ &
      eta + 1), 0.0d0, use_flux_correction) - Y(3)
B(2) = 2*cgs_stef*Y(2)**4 - Y(3)
MB(1,1) = 0
MB(2,1) = 0
MB(1,2) = 0
MB(2,2) = -8*cgs_stef*Y(2)**3
MB(1,3) = 1
MB(2,3) = 1
MB(1,4) = 2*eta*omega*z + merge(alpha*omega*z/(alpha*nu/eta + 1), 0.0d0, &
      use_flux_correction)
MB(2,4) = 0
end subroutine

pure subroutine mrx_output_md (z,Y,YY)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:), intent(out) :: YY
YY(1) = Y(1)
YY(2) = Y(2)
YY(3) = Y(2)
YY(4) = cgs_k_over_mh*Y(1)*Y(2)/miu
YY(5) = (4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c
YY(6) = Y(4)
YY(7) = Y(3)
YY(8) = 2*eta*omega*z*Y(4)
YY(9) = 0
YY(10) = cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(2) &
      **4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(4)
YY(11) = alpha*nu*omega*Y(4) - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu &
      + merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(4))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + omega*(alpha*nu + 2*eta)*Y(4)
YY(12) = -alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0) &
      *cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(4))*merge( &
      qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + omega*(alpha*nu + 2*eta)*Y(4)
YY(13) = alpha*nu*omega*Y(4)
YY(14) = eta*omega*z
YY(15) = (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw* &
      sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (4)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(4)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(4)))**threshpow + 2)
end subroutine

!------------------------------------------------------------------------------!
! heating-cooling balance (compton term only)
! magnetic heating
! no thermal conduction
pure subroutine mrx_coeff1_mw (z,Y,D,F,A,MY,MD)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
! first column: values, second column: 1ord derivatives
real(dp), dimension(:), intent(in) :: Y,D
! each row is one Function: its value and derivatives to rho and T
real(dp), dimension(:,:), intent(in) :: F
! right-hand-side of the equation
real(dp), dimension(:), intent(out) :: A
! jacobians with respect to Y and dY/dz
real(dp), dimension(:,:), intent(out) :: MY, MD
A(1) = -cgs_k_over_mh*D(1)*Y(2)/miu - cgs_k_over_mh*D(2)*Y(1)/miu - &
      omega**2*z*Y(1) - D(5) + F(1,1)*Y(1)*Y(4)/cgs_c
A(2) = -16*cgs_stef*D(3)*Y(3)**3 - 3*F(1,1)*Y(1)*Y(4)
A(3) = alpha*nu*omega*Y(5) - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + omega*(alpha*nu + 2*eta)*Y(5) - D(4)
A(4) = alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef &
      *Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge(qmri_kill &
      *(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt &
      (Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - eta*z*D(5) - (alpha*nu + 2*eta)*Y &
      (5)
MY(1,1) = cgs_k_over_mh*D(2)/miu + omega**2*z - F(1,1)*Y(4)/cgs_c - F(2, &
      1)*Y(1)*Y(4)/cgs_c
MY(2,1) = 3*F(1,1)*Y(4) + 3*F(2,1)*Y(1)*Y(4)
MY(3,1) = alpha*cgs_k_over_mh*omega*merge(qmri_kill*(0.646142399166004d0 &
      *sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge(( &
      4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + &
      Y(5))*merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(5)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(4,1) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(5)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(1,2) = cgs_k_over_mh*D(1)/miu - F(3,1)*Y(1)*Y(4)/cgs_c
MY(2,2) = 3*F(3,1)*Y(1)*Y(4)
MY(3,2) = alpha*cgs_k_over_mh*omega*merge(qmri_kill*(0.646142399166004d0 &
      *sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(1)/miu + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge(( &
      4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + &
      Y(5))*merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.323071199583002d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(2)*Y(5)) - 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) + 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(4,2) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(1)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.323071199583002d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(2)*Y(5)) - 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) + 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(1,3) = 0
MY(2,3) = 48*cgs_stef*D(3)*Y(3)**2
MY(3,3) = alpha*omega*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, 0.0d0 &
      , use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri)
MY(4,3) = -alpha*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, 0.0d0, &
      use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri)
MY(1,4) = -F(1,1)*Y(1)/cgs_c
MY(2,4) = 3*F(1,1)*Y(1)
MY(3,4) = 0
MY(4,4) = 0
MY(1,5) = 0
MY(2,5) = 0
MY(3,5) = -alpha*nu*omega + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)**2) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(5))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)**2) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2, 0.0d0, &
      use_quench_mri) + alpha*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - omega*(alpha*nu + 2*eta)
MY(4,5) = alpha*nu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)**2) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)**2) + 1.0d0*threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh &
      )*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))** &
      threshpow/Y(5))*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) &
      **2, 0.0d0, use_quench_mri) - alpha*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + 2*eta
MD(1,1) = cgs_k_over_mh*Y(2)/miu
MD(2,1) = 0
MD(3,1) = 0
MD(4,1) = 0
MD(1,2) = cgs_k_over_mh*Y(1)/miu
MD(2,2) = 0
MD(3,2) = 0
MD(4,2) = 0
MD(1,3) = 0
MD(2,3) = 16*cgs_stef*Y(3)**3
MD(3,3) = 0
MD(4,3) = 0
MD(1,4) = 0
MD(2,4) = 0
MD(3,4) = 1
MD(4,4) = 0
MD(1,5) = 1
MD(2,5) = 0
MD(3,5) = 0
MD(4,5) = eta*z
end subroutine

pure subroutine mrx_coeff0_mw (z,Y,F,C,MC)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: C
real(dp), dimension(:,:), intent(out) :: MC
C(1) = -alpha*nu*omega*Y(5) + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + 16*cgs_k_over_mec2*cgs_stef*(merge(4*cgs_k_over_mec2*Y(2) + 1 &
      , 1.0d0, use_relcompt)*Y(2) - Y(3))*F(1,3)*Y(1)*Y(3)**4 - omega*( &
      alpha*nu + 2*eta)*Y(5)
MC(1,1) = -alpha*cgs_k_over_mh*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri)*Y(2)/miu - alpha*omega*( &
      cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(3)** &
      4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega &
      *radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2)**2 + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (1)*Y(5)) + 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2), 0.0d0, &
      use_quench_mri) - 16*cgs_k_over_mec2*cgs_stef*(merge(4* &
      cgs_k_over_mec2*Y(2) + 1, 1.0d0, use_relcompt)*Y(2) - Y(3))*F(1,3 &
      )*Y(3)**4 - 16*cgs_k_over_mec2*cgs_stef*(merge(4*cgs_k_over_mec2* &
      Y(2) + 1, 1.0d0, use_relcompt)*Y(2) - Y(3))*F(2,3)*Y(1)*Y(3)**4
MC(1,2) = -alpha*cgs_k_over_mh*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri)*Y(1)/miu - alpha*omega*( &
      cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(3)** &
      4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)*(-0.323071199583002d0*sqrt(cgs_k_over_mh)*omega &
      *radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) - 0.5d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2)**2 + qmri_kill*(0.323071199583002d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (2)*Y(5)) + 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2), 0.0d0, &
      use_quench_mri) - 16*cgs_k_over_mec2*cgs_stef*(merge(4* &
      cgs_k_over_mec2, 0.0d0, use_relcompt)*Y(2) + merge(4* &
      cgs_k_over_mec2*Y(2) + 1, 1.0d0, use_relcompt))*F(1,3)*Y(1)*Y(3) &
      **4 - 16*cgs_k_over_mec2*cgs_stef*(merge(4*cgs_k_over_mec2*Y(2) + &
      1, 1.0d0, use_relcompt)*Y(2) - Y(3))*F(3,3)*Y(1)*Y(3)**4
MC(1,3) = -alpha*omega*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, &
      0.0d0, use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) - 64*cgs_k_over_mec2*cgs_stef*(merge(4*cgs_k_over_mec2*Y(2) + 1 &
      , 1.0d0, use_relcompt)*Y(2) - Y(3))*F(1,3)*Y(1)*Y(3)**3 + 16* &
      cgs_k_over_mec2*cgs_stef*F(1,3)*Y(1)*Y(3)**4
MC(1,4) = 0
MC(1,5) = alpha*nu*omega - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)**2) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(5))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)**2) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2, 0.0d0, &
      use_quench_mri) - alpha*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + omega*(alpha*nu + 2*eta)
end subroutine

pure subroutine mrx_coeffbl_mw (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -Y(4)
B(2) = alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef &
      *Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge(qmri_kill &
      *(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt &
      (Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - (alpha*nu + 2*eta)*Y(5)
MB(1,1) = 0
MB(2,1) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(5)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MB(1,2) = 0
MB(2,2) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(1)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.323071199583002d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(2)*Y(5)) - 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) + 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MB(1,3) = 0
MB(2,3) = -alpha*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, 0.0d0, &
      use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri)
MB(1,4) = 1
MB(2,4) = 0
MB(1,5) = 0
MB(2,5) = alpha*nu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)**2) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)**2) + 1.0d0*threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh &
      )*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))** &
      threshpow/Y(5))*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) &
      **2, 0.0d0, use_quench_mri) - alpha*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + 2*eta
end subroutine

pure subroutine mrx_coeffbr_mw (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -2*eta*omega*z*Y(5) + facc - merge(alpha*omega*z*Y(5)/(alpha*nu/ &
      eta + 1), 0.0d0, use_flux_correction) - Y(4)
B(2) = 2*cgs_stef*Y(3)**4 - Y(4)
MB(1,1) = 0
MB(2,1) = 0
MB(1,2) = 0
MB(2,2) = 0
MB(1,3) = 0
MB(2,3) = -8*cgs_stef*Y(3)**3
MB(1,4) = 1
MB(2,4) = 1
MB(1,5) = 2*eta*omega*z + merge(alpha*omega*z/(alpha*nu/eta + 1), 0.0d0, &
      use_flux_correction)
MB(2,5) = 0
end subroutine

pure subroutine mrx_output_mw (z,Y,YY)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:), intent(out) :: YY
YY(1) = Y(1)
YY(2) = Y(2)
YY(3) = Y(3)
YY(4) = cgs_k_over_mh*Y(1)*Y(2)/miu
YY(5) = (4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c
YY(6) = Y(5)
YY(7) = Y(4)
YY(8) = 2*eta*omega*z*Y(5)
YY(9) = 0
YY(10) = cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(3) &
      **4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5)
YY(11) = alpha*nu*omega*Y(5) - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu &
      + merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + omega*(alpha*nu + 2*eta)*Y(5)
YY(12) = -alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0) &
      *cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge( &
      qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + omega*(alpha*nu + 2*eta)*Y(5)
YY(13) = alpha*nu*omega*Y(5)
YY(14) = eta*omega*z
YY(15) = (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw* &
      sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)
end subroutine

!------------------------------------------------------------------------------!
! heating-cooling balance (full equation)
! magnetic heating
! no thermal conduction
pure subroutine mrx_coeff1_mc (z,Y,D,F,A,MY,MD)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
! first column: values, second column: 1ord derivatives
real(dp), dimension(:), intent(in) :: Y,D
! each row is one Function: its value and derivatives to rho and T
real(dp), dimension(:,:), intent(in) :: F
! right-hand-side of the equation
real(dp), dimension(:), intent(out) :: A
! jacobians with respect to Y and dY/dz
real(dp), dimension(:,:), intent(out) :: MY, MD
A(1) = -cgs_k_over_mh*D(1)*Y(2)/miu - cgs_k_over_mh*D(2)*Y(1)/miu - &
      omega**2*z*Y(1) - D(5) + F(1,1)*Y(1)*Y(4)/cgs_c
A(2) = -16*cgs_stef*D(3)*Y(3)**3 - 3*F(1,1)*Y(1)*Y(4)
A(3) = alpha*nu*omega*Y(5) - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + omega*(alpha*nu + 2*eta)*Y(5) - D(4)
A(4) = alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef &
      *Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge(qmri_kill &
      *(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt &
      (Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - eta*z*D(5) - (alpha*nu + 2*eta)*Y &
      (5)
MY(1,1) = cgs_k_over_mh*D(2)/miu + omega**2*z - F(1,1)*Y(4)/cgs_c - F(2, &
      1)*Y(1)*Y(4)/cgs_c
MY(2,1) = 3*F(1,1)*Y(4) + 3*F(2,1)*Y(1)*Y(4)
MY(3,1) = alpha*cgs_k_over_mh*omega*merge(qmri_kill*(0.646142399166004d0 &
      *sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge(( &
      4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + &
      Y(5))*merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(5)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(4,1) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(5)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(1,2) = cgs_k_over_mh*D(1)/miu - F(3,1)*Y(1)*Y(4)/cgs_c
MY(2,2) = 3*F(3,1)*Y(1)*Y(4)
MY(3,2) = alpha*cgs_k_over_mh*omega*merge(qmri_kill*(0.646142399166004d0 &
      *sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(1)/miu + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge(( &
      4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + &
      Y(5))*merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.323071199583002d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(2)*Y(5)) - 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) + 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(4,2) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(1)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.323071199583002d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(2)*Y(5)) - 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) + 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(1,3) = 0
MY(2,3) = 48*cgs_stef*D(3)*Y(3)**2
MY(3,3) = alpha*omega*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, 0.0d0 &
      , use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri)
MY(4,3) = -alpha*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, 0.0d0, &
      use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri)
MY(1,4) = -F(1,1)*Y(1)/cgs_c
MY(2,4) = 3*F(1,1)*Y(1)
MY(3,4) = 0
MY(4,4) = 0
MY(1,5) = 0
MY(2,5) = 0
MY(3,5) = -alpha*nu*omega + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)**2) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(5))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)**2) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2, 0.0d0, &
      use_quench_mri) + alpha*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - omega*(alpha*nu + 2*eta)
MY(4,5) = alpha*nu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)**2) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)**2) + 1.0d0*threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh &
      )*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))** &
      threshpow/Y(5))*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) &
      **2, 0.0d0, use_quench_mri) - alpha*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + 2*eta
MD(1,1) = cgs_k_over_mh*Y(2)/miu
MD(2,1) = 0
MD(3,1) = 0
MD(4,1) = 0
MD(1,2) = cgs_k_over_mh*Y(1)/miu
MD(2,2) = 0
MD(3,2) = 0
MD(4,2) = 0
MD(1,3) = 0
MD(2,3) = 16*cgs_stef*Y(3)**3
MD(3,3) = 0
MD(4,3) = 0
MD(1,4) = 0
MD(2,4) = 0
MD(3,4) = 1
MD(4,4) = 0
MD(1,5) = 1
MD(2,5) = 0
MD(3,5) = 0
MD(4,5) = eta*z
end subroutine

pure subroutine mrx_coeff0_mc (z,Y,F,C,MC)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: C
real(dp), dimension(:,:), intent(out) :: MC
C(1) = -alpha*nu*omega*Y(5) + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + 4*cgs_stef*(4*cgs_k_over_mec2*(merge(4*cgs_k_over_mec2*Y(2) + &
      1, 1.0d0, use_relcompt)*Y(2) - Y(3))*F(1,3)*Y(3)**4 + (Y(2)**4 - &
      Y(3)**4)*F(1,2))*Y(1) - omega*(alpha*nu + 2*eta)*Y(5)
MC(1,1) = -alpha*cgs_k_over_mh*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri)*Y(2)/miu - alpha*omega*( &
      cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(3)** &
      4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega &
      *radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2)**2 + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (1)*Y(5)) + 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2), 0.0d0, &
      use_quench_mri) - 4*cgs_stef*(4*cgs_k_over_mec2*(merge(4* &
      cgs_k_over_mec2*Y(2) + 1, 1.0d0, use_relcompt)*Y(2) - Y(3))*F(1,3 &
      )*Y(3)**4 + (Y(2)**4 - Y(3)**4)*F(1,2)) - 4*cgs_stef*(4* &
      cgs_k_over_mec2*(merge(4*cgs_k_over_mec2*Y(2) + 1, 1.0d0, &
      use_relcompt)*Y(2) - Y(3))*F(2,3)*Y(3)**4 + (Y(2)**4 - Y(3)**4)*F &
      (2,2))*Y(1)
MC(1,2) = -alpha*cgs_k_over_mh*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri)*Y(1)/miu - alpha*omega*( &
      cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(3)** &
      4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)*(-0.323071199583002d0*sqrt(cgs_k_over_mh)*omega &
      *radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) - 0.5d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2)**2 + qmri_kill*(0.323071199583002d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (2)*Y(5)) + 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2), 0.0d0, &
      use_quench_mri) - 4*cgs_stef*(4*cgs_k_over_mec2*(merge(4* &
      cgs_k_over_mec2, 0.0d0, use_relcompt)*Y(2) + merge(4* &
      cgs_k_over_mec2*Y(2) + 1, 1.0d0, use_relcompt))*F(1,3)*Y(3)**4 + &
      4*cgs_k_over_mec2*(merge(4*cgs_k_over_mec2*Y(2) + 1, 1.0d0, &
      use_relcompt)*Y(2) - Y(3))*F(3,3)*Y(3)**4 + (Y(2)**4 - Y(3)**4)*F &
      (3,2) + 4*F(1,2)*Y(2)**3)*Y(1)
MC(1,3) = -alpha*omega*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, &
      0.0d0, use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) - 4*cgs_stef*(16*cgs_k_over_mec2*(merge(4*cgs_k_over_mec2*Y(2) &
      + 1, 1.0d0, use_relcompt)*Y(2) - Y(3))*F(1,3)*Y(3)**3 - 4* &
      cgs_k_over_mec2*F(1,3)*Y(3)**4 - 4*F(1,2)*Y(3)**3)*Y(1)
MC(1,4) = 0
MC(1,5) = alpha*nu*omega - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)**2) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(5))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)**2) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2, 0.0d0, &
      use_quench_mri) - alpha*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + omega*(alpha*nu + 2*eta)
end subroutine

pure subroutine mrx_coeffbl_mc (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -Y(4)
B(2) = alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef &
      *Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge(qmri_kill &
      *(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt &
      (Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - (alpha*nu + 2*eta)*Y(5)
MB(1,1) = 0
MB(2,1) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(5)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MB(1,2) = 0
MB(2,2) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(1)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.323071199583002d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(2)*Y(5)) - 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) + 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MB(1,3) = 0
MB(2,3) = -alpha*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, 0.0d0, &
      use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri)
MB(1,4) = 1
MB(2,4) = 0
MB(1,5) = 0
MB(2,5) = alpha*nu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)**2) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)**2) + 1.0d0*threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh &
      )*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))** &
      threshpow/Y(5))*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) &
      **2, 0.0d0, use_quench_mri) - alpha*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + 2*eta
end subroutine

pure subroutine mrx_coeffbr_mc (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -2*eta*omega*z*Y(5) + facc - merge(alpha*omega*z*Y(5)/(alpha*nu/ &
      eta + 1), 0.0d0, use_flux_correction) - Y(4)
B(2) = 2*cgs_stef*Y(3)**4 - Y(4)
MB(1,1) = 0
MB(2,1) = 0
MB(1,2) = 0
MB(2,2) = 0
MB(1,3) = 0
MB(2,3) = -8*cgs_stef*Y(3)**3
MB(1,4) = 1
MB(2,4) = 1
MB(1,5) = 2*eta*omega*z + merge(alpha*omega*z/(alpha*nu/eta + 1), 0.0d0, &
      use_flux_correction)
MB(2,5) = 0
end subroutine

pure subroutine mrx_output_mc (z,Y,YY)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:), intent(out) :: YY
YY(1) = Y(1)
YY(2) = Y(2)
YY(3) = Y(3)
YY(4) = cgs_k_over_mh*Y(1)*Y(2)/miu
YY(5) = (4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c
YY(6) = Y(5)
YY(7) = Y(4)
YY(8) = 2*eta*omega*z*Y(5)
YY(9) = 0
YY(10) = cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(3) &
      **4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5)
YY(11) = alpha*nu*omega*Y(5) - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu &
      + merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + omega*(alpha*nu + 2*eta)*Y(5)
YY(12) = -alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0) &
      *cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge( &
      qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + omega*(alpha*nu + 2*eta)*Y(5)
YY(13) = alpha*nu*omega*Y(5)
YY(14) = eta*omega*z
YY(15) = (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw* &
      sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)
end subroutine

!------------------------------------------------------------------------------!
! thermal diffusion
! magnetic heating
! radiation + thermal conduction
pure subroutine mrx_coeff1_mdt (z,Y,D,F,A,MY,MD)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
! first column: values, second column: 1ord derivatives
real(dp), dimension(:), intent(in) :: Y,D
! each row is one Function: its value and derivatives to rho and T
real(dp), dimension(:,:), intent(in) :: F
! right-hand-side of the equation
real(dp), dimension(:), intent(out) :: A
! jacobians with respect to Y and dY/dz
real(dp), dimension(:,:), intent(out) :: MY, MD
A(1) = -cgs_k_over_mh*D(1)*Y(2)/miu - cgs_k_over_mh*D(2)*Y(1)/miu - &
      omega**2*z*Y(1) - D(5) + F(1,1)*Y(1)*Y(3)/cgs_c
A(2) = -16*cgs_stef*D(2)*Y(2)**3 - 3*F(1,1)*Y(1)*Y(3)
A(3) = alpha*nu*omega*Y(5) - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + omega*(alpha*nu + 2*eta)*Y(5) - D(3) - D(4)
A(4) = alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef &
      *Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge(qmri_kill &
      *(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt &
      (Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - eta*z*D(5) - (alpha*nu + 2*eta)*Y &
      (5)
A(5) = -D(2)*F(1,4) - Y(4)
MY(1,1) = cgs_k_over_mh*D(2)/miu + omega**2*z - F(1,1)*Y(3)/cgs_c - F(2, &
      1)*Y(1)*Y(3)/cgs_c
MY(2,1) = 3*F(1,1)*Y(3) + 3*F(2,1)*Y(1)*Y(3)
MY(3,1) = alpha*cgs_k_over_mh*omega*merge(qmri_kill*(0.646142399166004d0 &
      *sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge(( &
      4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + &
      Y(5))*merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(5)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(4,1) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(5)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(5,1) = D(2)*F(2,4)
MY(1,2) = cgs_k_over_mh*D(1)/miu - F(3,1)*Y(1)*Y(3)/cgs_c
MY(2,2) = 48*cgs_stef*D(2)*Y(2)**2 + 3*F(3,1)*Y(1)*Y(3)
MY(3,2) = alpha*omega*(cgs_k_over_mh*Y(1)/miu + merge((16.0d0/3.0d0)* &
      cgs_stef*Y(2)**3/cgs_c, 0.0d0, use_prad_in_alpha))*merge( &
      qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + alpha*omega*(cgs_k_over_mh*Y(1)*Y &
      (2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*( &
      -0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt( &
      Y(1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) - 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2)**2 + qmri_kill*(0.323071199583002d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (2)*Y(5)) + 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2), 0.0d0, &
      use_quench_mri)
MY(4,2) = -alpha*(cgs_k_over_mh*Y(1)/miu + merge((16.0d0/3.0d0)*cgs_stef &
      *Y(2)**3/cgs_c, 0.0d0, use_prad_in_alpha))*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - alpha*(cgs_k_over_mh*Y(1)*Y(2)/ &
      miu + merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*( &
      -0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt( &
      Y(1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) - 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2)**2 + qmri_kill*(0.323071199583002d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (2)*Y(5)) + 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2), 0.0d0, &
      use_quench_mri)
MY(5,2) = D(2)*F(3,4)
MY(1,3) = -F(1,1)*Y(1)/cgs_c
MY(2,3) = 3*F(1,1)*Y(1)
MY(3,3) = 0
MY(4,3) = 0
MY(5,3) = 0
MY(1,4) = 0
MY(2,4) = 0
MY(3,4) = 0
MY(4,4) = 0
MY(5,4) = 1
MY(1,5) = 0
MY(2,5) = 0
MY(3,5) = -alpha*nu*omega + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)**2) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(5))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)**2) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2, 0.0d0, &
      use_quench_mri) + alpha*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - omega*(alpha*nu + 2*eta)
MY(4,5) = alpha*nu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)**2) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)**2) + 1.0d0*threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh &
      )*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))** &
      threshpow/Y(5))*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) &
      **2, 0.0d0, use_quench_mri) - alpha*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + 2*eta
MY(5,5) = 0
MD(1,1) = cgs_k_over_mh*Y(2)/miu
MD(2,1) = 0
MD(3,1) = 0
MD(4,1) = 0
MD(5,1) = 0
MD(1,2) = cgs_k_over_mh*Y(1)/miu
MD(2,2) = 16*cgs_stef*Y(2)**3
MD(3,2) = 0
MD(4,2) = 0
MD(5,2) = F(1,4)
MD(1,3) = 0
MD(2,3) = 0
MD(3,3) = 1
MD(4,3) = 0
MD(5,3) = 0
MD(1,4) = 0
MD(2,4) = 0
MD(3,4) = 1
MD(4,4) = 0
MD(5,4) = 0
MD(1,5) = 1
MD(2,5) = 0
MD(3,5) = 0
MD(4,5) = eta*z
MD(5,5) = 0
end subroutine

pure subroutine mrx_coeffbl_mdt (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -Y(3)
B(2) = alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef &
      *Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge(qmri_kill &
      *(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt &
      (Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - (alpha*nu + 2*eta)*Y(5)
B(3) = -Y(4)
MB(1,1) = 0
MB(2,1) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(5)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(5)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2), 0.0d0, use_quench_mri)
MB(3,1) = 0
MB(1,2) = 0
MB(2,2) = -alpha*(cgs_k_over_mh*Y(1)/miu + merge((16.0d0/3.0d0)*cgs_stef &
      *Y(2)**3/cgs_c, 0.0d0, use_prad_in_alpha))*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - alpha*(cgs_k_over_mh*Y(1)*Y(2)/ &
      miu + merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)*( &
      -0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt( &
      Y(1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(5)) - 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2)**2 + qmri_kill*(0.323071199583002d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (2)*Y(5)) + 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2), 0.0d0, &
      use_quench_mri)
MB(3,2) = 0
MB(1,3) = 1
MB(2,3) = 0
MB(3,3) = 0
MB(1,4) = 0
MB(2,4) = 0
MB(3,4) = 1
MB(1,5) = 0
MB(2,5) = alpha*nu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))* &
      merge(qmri_kill*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)**2) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow/Y(5))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)**2) + 1.0d0*threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh &
      )*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))** &
      threshpow/Y(5))*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) &
      **2, 0.0d0, use_quench_mri) - alpha*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + 2*eta
MB(3,5) = 0
end subroutine

pure subroutine mrx_coeffbr_mdt (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -2*eta*omega*z*Y(5) + facc - merge(alpha*omega*z*Y(5)/(alpha*nu/ &
      eta + 1), 0.0d0, use_flux_correction) - Y(3) - Y(4)
B(2) = 2*cgs_stef*Y(2)**4 - Y(3)
MB(1,1) = 0
MB(2,1) = 0
MB(1,2) = 0
MB(2,2) = -8*cgs_stef*Y(2)**3
MB(1,3) = 1
MB(2,3) = 1
MB(1,4) = 1
MB(2,4) = 0
MB(1,5) = 2*eta*omega*z + merge(alpha*omega*z/(alpha*nu/eta + 1), 0.0d0, &
      use_flux_correction)
MB(2,5) = 0
end subroutine

pure subroutine mrx_output_mdt (z,Y,YY)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:), intent(out) :: YY
YY(1) = Y(1)
YY(2) = Y(2)
YY(3) = Y(2)
YY(4) = cgs_k_over_mh*Y(1)*Y(2)/miu
YY(5) = (4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c
YY(6) = Y(5)
YY(7) = Y(3)
YY(8) = 2*eta*omega*z*Y(5)
YY(9) = Y(4)
YY(10) = cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(2) &
      **4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5)
YY(11) = alpha*nu*omega*Y(5) - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu &
      + merge((4.0d0/3.0d0)*cgs_stef*Y(2)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(5))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + omega*(alpha*nu + 2*eta)*Y(5)
YY(12) = -alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0) &
      *cgs_stef*Y(2)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(5))*merge( &
      qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + omega*(alpha*nu + 2*eta)*Y(5)
YY(13) = alpha*nu*omega*Y(5)
YY(14) = eta*omega*z
YY(15) = (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw* &
      sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (5)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(5)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(5)))**threshpow + 2)
end subroutine

!------------------------------------------------------------------------------!
! heating-cooling balance (full equation)
! magnetic heating
! radiation + thermal conduction
pure subroutine mrx_coeff1_mct (z,Y,D,F,A,MY,MD)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
! first column: values, second column: 1ord derivatives
real(dp), dimension(:), intent(in) :: Y,D
! each row is one Function: its value and derivatives to rho and T
real(dp), dimension(:,:), intent(in) :: F
! right-hand-side of the equation
real(dp), dimension(:), intent(out) :: A
! jacobians with respect to Y and dY/dz
real(dp), dimension(:,:), intent(out) :: MY, MD
A(1) = -cgs_k_over_mh*D(1)*Y(2)/miu - cgs_k_over_mh*D(2)*Y(1)/miu - &
      omega**2*z*Y(1) - D(6) + F(1,1)*Y(1)*Y(4)/cgs_c
A(2) = -16*cgs_stef*D(3)*Y(3)**3 - 3*F(1,1)*Y(1)*Y(4)
A(3) = alpha*nu*omega*Y(6) - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(6))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + omega*(alpha*nu + 2*eta)*Y(6) - D(4) - D(5)
A(4) = alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef &
      *Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(6))*merge(qmri_kill &
      *(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt &
      (Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - eta*z*D(6) - (alpha*nu + 2*eta)*Y &
      (6)
A(5) = -4*cgs_stef*(4*cgs_k_over_mec2*(merge(4*cgs_k_over_mec2*Y(2) + 1, &
      1.0d0, use_relcompt)*Y(2) - Y(3))*F(1,3)*Y(3)**4 + (Y(2)**4 - Y(3 &
      )**4)*F(1,2))*Y(1) + D(4)
A(6) = -D(2)*F(1,4) - Y(5)
MY(1,1) = cgs_k_over_mh*D(2)/miu + omega**2*z - F(1,1)*Y(4)/cgs_c - F(2, &
      1)*Y(1)*Y(4)/cgs_c
MY(2,1) = 3*F(1,1)*Y(4) + 3*F(2,1)*Y(1)*Y(4)
MY(3,1) = alpha*cgs_k_over_mh*omega*merge(qmri_kill*(0.646142399166004d0 &
      *sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge(( &
      4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + &
      Y(6))*merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(6)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(6)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(4,1) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(6))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(6)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(6)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(5,1) = 4*cgs_stef*(4*cgs_k_over_mec2*(merge(4*cgs_k_over_mec2*Y(2) + &
      1, 1.0d0, use_relcompt)*Y(2) - Y(3))*F(1,3)*Y(3)**4 + (Y(2)**4 - &
      Y(3)**4)*F(1,2)) + 4*cgs_stef*(4*cgs_k_over_mec2*(merge(4* &
      cgs_k_over_mec2*Y(2) + 1, 1.0d0, use_relcompt)*Y(2) - Y(3))*F(2,3 &
      )*Y(3)**4 + (Y(2)**4 - Y(3)**4)*F(2,2))*Y(1)
MY(6,1) = D(2)*F(2,4)
MY(1,2) = cgs_k_over_mh*D(1)/miu - F(3,1)*Y(1)*Y(4)/cgs_c
MY(2,2) = 3*F(3,1)*Y(1)*Y(4)
MY(3,2) = alpha*cgs_k_over_mh*omega*merge(qmri_kill*(0.646142399166004d0 &
      *sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(1)/miu + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge(( &
      4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + &
      Y(6))*merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)*(-0.323071199583002d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(2)*Y(6)) - 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2)**2 + qmri_kill*( &
      0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(6)) + 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(4,2) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(1)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(6))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)*(-0.323071199583002d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(2)*Y(6)) - 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2)**2 + qmri_kill*( &
      0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(6)) + 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2), 0.0d0, use_quench_mri)
MY(5,2) = 4*cgs_stef*(4*cgs_k_over_mec2*(merge(4*cgs_k_over_mec2, 0.0d0, &
      use_relcompt)*Y(2) + merge(4*cgs_k_over_mec2*Y(2) + 1, 1.0d0, &
      use_relcompt))*F(1,3)*Y(3)**4 + 4*cgs_k_over_mec2*(merge(4* &
      cgs_k_over_mec2*Y(2) + 1, 1.0d0, use_relcompt)*Y(2) - Y(3))*F(3,3 &
      )*Y(3)**4 + (Y(2)**4 - Y(3)**4)*F(3,2) + 4*F(1,2)*Y(2)**3)*Y(1)
MY(6,2) = D(2)*F(3,4)
MY(1,3) = 0
MY(2,3) = 48*cgs_stef*D(3)*Y(3)**2
MY(3,3) = alpha*omega*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, 0.0d0 &
      , use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri)
MY(4,3) = -alpha*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, 0.0d0, &
      use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri)
MY(5,3) = 4*cgs_stef*(16*cgs_k_over_mec2*(merge(4*cgs_k_over_mec2*Y(2) + &
      1, 1.0d0, use_relcompt)*Y(2) - Y(3))*F(1,3)*Y(3)**3 - 4* &
      cgs_k_over_mec2*F(1,3)*Y(3)**4 - 4*F(1,2)*Y(3)**3)*Y(1)
MY(6,3) = 0
MY(1,4) = -F(1,1)*Y(1)/cgs_c
MY(2,4) = 3*F(1,1)*Y(1)
MY(3,4) = 0
MY(4,4) = 0
MY(5,4) = 0
MY(6,4) = 0
MY(1,5) = 0
MY(2,5) = 0
MY(3,5) = 0
MY(4,5) = 0
MY(5,5) = 0
MY(6,5) = 1
MY(1,6) = 0
MY(2,6) = 0
MY(3,6) = -alpha*nu*omega + alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + &
      merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(6))*merge(qmri_kill*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(6)**2) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow/Y(6))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2) + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)**2) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow/Y(6))*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2)**2, 0.0d0, &
      use_quench_mri) + alpha*omega*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - omega*(alpha*nu + 2*eta)
MY(4,6) = alpha*nu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(6))* &
      merge(qmri_kill*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)**2) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow/Y(6))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)**2) + 1.0d0*threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh &
      )*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))** &
      threshpow/Y(6))*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2) &
      **2, 0.0d0, use_quench_mri) - alpha*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + 2*eta
MY(5,6) = 0
MY(6,6) = 0
MD(1,1) = cgs_k_over_mh*Y(2)/miu
MD(2,1) = 0
MD(3,1) = 0
MD(4,1) = 0
MD(5,1) = 0
MD(6,1) = 0
MD(1,2) = cgs_k_over_mh*Y(1)/miu
MD(2,2) = 0
MD(3,2) = 0
MD(4,2) = 0
MD(5,2) = 0
MD(6,2) = F(1,4)
MD(1,3) = 0
MD(2,3) = 16*cgs_stef*Y(3)**3
MD(3,3) = 0
MD(4,3) = 0
MD(5,3) = 0
MD(6,3) = 0
MD(1,4) = 0
MD(2,4) = 0
MD(3,4) = 1
MD(4,4) = 0
MD(5,4) = -1
MD(6,4) = 0
MD(1,5) = 0
MD(2,5) = 0
MD(3,5) = 1
MD(4,5) = 0
MD(5,5) = 0
MD(6,5) = 0
MD(1,6) = 1
MD(2,6) = 0
MD(3,6) = 0
MD(4,6) = eta*z
MD(5,6) = 0
MD(6,6) = 0
end subroutine

pure subroutine mrx_coeffbl_mct (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -Y(4)
B(2) = alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef &
      *Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(6))*merge(qmri_kill &
      *(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt &
      (Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) - (alpha*nu + 2*eta)*Y(6)
B(3) = -Y(2) + Y(3)
B(4) = -Y(5)
MB(1,1) = 0
MB(2,1) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(2)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(6))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)*(-0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(1)*Y(6)) - 1.0d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow/Y(1))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2)**2 + qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(1)*Y(6)) + 1.0d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow/Y(1))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2), 0.0d0, use_quench_mri)
MB(3,1) = 0
MB(4,1) = 0
MB(1,2) = 0
MB(2,2) = -alpha*cgs_k_over_mh*merge(qmri_kill*(0.646142399166004d0*sqrt &
      (cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)* &
      Y(6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri) &
      *Y(1)/miu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(6))* &
      merge(qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)*(-0.323071199583002d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(2)*Y(6)) - 0.5d0*threshpow*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow/Y(2))/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2)**2 + qmri_kill*( &
      0.323071199583002d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(2)*Y(6)) + 0.5d0*threshpow*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow/Y(2))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2), 0.0d0, use_quench_mri)
MB(3,2) = 1
MB(4,2) = 0
MB(1,3) = 0
MB(2,3) = -alpha*merge((16.0d0/3.0d0)*cgs_stef*Y(3)**3/cgs_c, 0.0d0, &
      use_prad_in_alpha)*merge(qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri)
MB(3,3) = -1
MB(4,3) = 0
MB(1,4) = 1
MB(2,4) = 0
MB(3,4) = 0
MB(4,4) = 0
MB(1,5) = 0
MB(2,5) = 0
MB(3,5) = 0
MB(4,5) = 1
MB(1,6) = 0
MB(2,6) = alpha*nu - alpha*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/ &
      3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(6))* &
      merge(qmri_kill*(-0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)**2) - 1.0d0* &
      threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow/Y(6))/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) + qmri_kill*(0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)**2) + 1.0d0*threshpow*(0.646142399166004d0*sqrt(cgs_k_over_mh &
      )*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))** &
      threshpow/Y(6))*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2) &
      **2, 0.0d0, use_quench_mri) - alpha*merge(qmri_kill*( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + 2*eta
MB(3,6) = 0
MB(4,6) = 0
end subroutine

pure subroutine mrx_coeffbr_mct (z,Y,F,B,MB)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:,:), intent(in) :: F
real(dp), dimension(:), intent(out) :: B
real(dp), dimension(:,:), intent(out) :: MB
B(1) = -2*eta*omega*z*Y(6) + facc - merge(alpha*omega*z*Y(6)/(alpha*nu/ &
      eta + 1), 0.0d0, use_flux_correction) - Y(4) - Y(5)
B(2) = 2*cgs_stef*Y(3)**4 - Y(4)
MB(1,1) = 0
MB(2,1) = 0
MB(1,2) = 0
MB(2,2) = 0
MB(1,3) = 0
MB(2,3) = -8*cgs_stef*Y(3)**3
MB(1,4) = 1
MB(2,4) = 1
MB(1,5) = 1
MB(2,5) = 0
MB(1,6) = 2*eta*omega*z + merge(alpha*omega*z/(alpha*nu/eta + 1), 0.0d0, &
      use_flux_correction)
MB(2,6) = 0
end subroutine

pure subroutine mrx_output_mct (z,Y,YY)
use iso_fortran_env, only: dp => real64
implicit none
real(dp), intent(in) :: z
real(dp), dimension(:), intent(in) :: Y
real(dp), dimension(:), intent(out) :: YY
YY(1) = Y(1)
YY(2) = Y(2)
YY(3) = Y(3)
YY(4) = cgs_k_over_mh*Y(1)*Y(2)/miu
YY(5) = (4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c
YY(6) = Y(6)
YY(7) = Y(4)
YY(8) = 2*eta*omega*z*Y(6)
YY(9) = Y(5)
YY(10) = cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0)*cgs_stef*Y(3) &
      **4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(6)
YY(11) = alpha*nu*omega*Y(6) - alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu &
      + merge((4.0d0/3.0d0)*cgs_stef*Y(3)**4/cgs_c, 0.0d0, &
      use_prad_in_alpha) + Y(6))*merge(qmri_kill*(0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(6)) + (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow)/( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow + 2) - qmri_kill + 1.0d0, 1.0d0, use_quench_mri &
      ) + omega*(alpha*nu + 2*eta)*Y(6)
YY(12) = -alpha*omega*(cgs_k_over_mh*Y(1)*Y(2)/miu + merge((4.0d0/3.0d0) &
      *cgs_stef*Y(3)**4/cgs_c, 0.0d0, use_prad_in_alpha) + Y(6))*merge( &
      qmri_kill*(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius* &
      rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0* &
      sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt( &
      miu)*Y(6)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)* &
      omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2) - qmri_kill + &
      1.0d0, 1.0d0, use_quench_mri) + omega*(alpha*nu + 2*eta)*Y(6)
YY(13) = alpha*nu*omega*Y(6)
YY(14) = eta*omega*z
YY(15) = (0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw* &
      sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + (0.646142399166004d0*sqrt( &
      cgs_k_over_mh)*omega*radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y &
      (6)))**threshpow)/(0.646142399166004d0*sqrt(cgs_k_over_mh)*omega* &
      radius*rschw*sqrt(Y(1)**2*Y(2))/(sqrt(miu)*Y(6)) + ( &
      0.646142399166004d0*sqrt(cgs_k_over_mh)*omega*radius*rschw*sqrt(Y &
      (1)**2*Y(2))/(sqrt(miu)*Y(6)))**threshpow + 2)
end subroutine

